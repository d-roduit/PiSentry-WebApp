<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/placeholder-loading/dist/css/placeholder-loading.min.css">
    <title>My recordings</title>
    <style>
        div.fake-video-placeholder {
            height: 270px;
            width: 480px;
            margin-bottom: 10px;
        }

        video {
            display: none;
            height: 270px;
            width: 480px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>Hello on the recording</h1>

    <script type="module">
        import FetchRequest from './helpers/FetchRequest.js';
        import config from './config/config.js';

        FetchRequest
            .defaultResponseNotOk((response) => console.log(response))
            .defaultException((err) => console.log(err));

        const { backendApiUrl } = config;
        const recordingsEndpoint = `${backendApiUrl}/v1/recordings`;

        const addRecordingToPage = (recordingFilename, index) => {
            // Create fake design
            const fakeVideoPlaceholder = document.createElement('div');
            fakeVideoPlaceholder.id = `fake-video-placeholder-${index}`;
            fakeVideoPlaceholder.classList.add('ph-item', 'ph-picture', 'fake-video-placeholder');

            // Create video element
            const videoElement = document.createElement('video');
            videoElement.src = `${recordingsEndpoint}/${recordingFilename}?access_token=mytoken`;
            videoElement.controls = true;
            videoElement.addEventListener('loadeddata', function() {
                this.style.display = 'block';
                fakeVideoPlaceholder.style.display = 'none';
            });

            videoElement.addEventListener('error', () => {
                fakeVideoPlaceholder.textContent = 'Loading error';
            })

            // Append elements to DOM
            document.body.append(videoElement, fakeVideoPlaceholder);
        };

        new FetchRequest(recordingsEndpoint)
            .options({
                method: 'GET',
                headers: { Authorization: 'mytoken' }
            })
            .success((data) => {
                data.detectionSessions.forEach((detectionSession) => {
                    detectionSession.recordings.forEach((recording, index) => {
                        addRecordingToPage(recording.recording_filename, index);
                    });
                });
            })
            .make();
    </script>
</body>
</html>
